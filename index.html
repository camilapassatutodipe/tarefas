<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel ‚Äî Ag√™ncia Dipe (filtro + relat√≥rio)</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#1b1b18; --muted:#6b6b65; --paper:#f5f4ea; --card:#ffffff; --border:#e7e4d9;
    --accent:#ff573b; --ok:#1fbf74; --warn:#e53935; --work:#2563eb; --idle:#9ca3af;
    --c-construcione:#374151; --c-matec:#02b8b5; --c-vertticom:#b4533a; --c-lrocha:#c62828;
  }
  *{box-sizing:border-box}
  body{margin:0; font:15px/1.6 Roboto,system-ui,-apple-system,Segoe UI,Helvetica,Arial; color:var(--ink); background:var(--paper)}
  .wrap{max-width:1100px; margin:24px auto; padding:0 16px}
  h1{margin:0 0 14px; font-size:22px; font-weight:900}
  .sub{color:var(--muted); margin-bottom:12px}

  .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; background:#fff; padding:10px; border:1px solid var(--border); border-radius:12px}
  .input{border:1px solid var(--border); background:#fff; border-radius:10px; padding:10px 12px; min-width:260px}
  .select,.btn{border:1px solid var(--border); background:#fff; border-radius:10px; padding:10px 12px; cursor:pointer}
  .btn{font-weight:900}
  .chip{display:inline-flex; align-items:center; gap:6px; border:1px solid var(--border); background:#fff; border-radius:999px; padding:4px 10px; font-weight:900}
  .chip.dot:before{content:""; display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--accent)}
  .chip.c-construcione{color:var(--c-construcione); border-color:var(--c-construcione)}
  .chip.c-matec{color:var(--c-matec); border-color:var(--c-matec)}
  .chip.c-vertticom{color:var(--c-vertticom); border-color:var(--c-vertticom)}
  .chip.c-lrocha{color:var(--c-lrocha); border-color:var(--c-lrocha)}
  .chip.active{background:#fff8f2; border-color:var(--accent); color:var(--accent)}

  .weekbar{display:flex; align-items:center; gap:8px; margin:16px 0 10px}
  .range{font-weight:900}
  .btn.icon{padding:6px 10px}

  .card{background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px}
  .sectionTitle{display:flex; align-items:center; gap:8px; font-weight:900; margin:10px 0}
  .sectionTitle .icon{font-size:18px}

  /* Agenda (lista com bullets) */
  .agenda h3{margin:14px 0 6px; font-size:14px; color:#3b3b36}
  .agenda ul{margin:0 0 8px 18px}
  .agenda li{margin:4px 0}
  .tag{display:inline-block; font-size:12px; border:1px solid var(--border); padding:0 8px; border-radius:999px; margin-right:6px}
  .tag.c-construcione{color:var(--c-construcione); border-color:var(--c-construcione)}
  .tag.c-matec{color:var(--c-matec); border-color:var(--c-matec)}
  .tag.c-vertticom{color:var(--c-vertticom); border-color:var(--c-vertticom)}
  .tag.c-lrocha{color:var(--c-lrocha); border-color:var(--c-lrocha)}
  .st{display:inline-flex; align-items:center; gap:6px; border:1px dashed var(--border); padding:0 8px; border-radius:999px; font-size:12px; margin-left:6px; cursor:pointer}
  .dot{width:8px; height:8px; border-radius:50%; background:var(--idle)}
  .st.parado .dot{background:var(--idle)}
  .st.em_producao .dot{background:var(--work)}
  .st.atrasado .dot{background:var(--warn)}
  .st.feito .dot{background:var(--ok)}
  .done{opacity:.55; text-decoration:line-through}

  /* Relat√≥rio por cliente */
  table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden}
  thead th{position:sticky; top:0; background:#faf9f3; z-index:1}
  th, td{border-bottom:1px solid var(--border); padding:10px 12px; text-align:left}
  tbody tr:hover td{background:#fffdf8}
  .right{text-align:right}
  .clientsBar{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px}
  .muted{color:var(--muted); font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Painel de Tarefas ‚Äî Ag√™ncia Dipe</h1>
  <div class="sub">Busca, filtros, exporta√ß√£o e estat√≠sticas por cliente.</div>

  <!-- Barra da semana -->
  <div class="weekbar">
    <button class="btn icon" id="prevW">‚óÄ</button>
    <div class="range" id="weekRange">Semana</div>
    <button class="btn icon" id="nextW">‚ñ∂</button>
    <input class="select" type="date" id="weekPick" />
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <input class="input" id="q" placeholder="Buscar por t√≠tulo/nota/cliente..." />
    <label class="chip dot"><input id="hideDone" type="checkbox" style="margin-right:6px" checked> Ocultar conclu√≠das</label>
    <select class="select" id="statusSel" aria-label="Status">
      <option value="todas">Status: Todas</option>
      <option value="parado">Parado</option>
      <option value="em_producao">Em produ√ß√£o</option>
      <option value="atrasado">Atrasado</option>
      <option value="feito">Feito</option>
    </select>
    <button class="btn" id="csvBtn">Exportar CSV</button>
    <div style="flex:1"></div>
    <!-- Adicionar tarefa r√°pida -->
    <select class="select" id="qaClient">
      <option>Construcione</option><option>Matec</option><option>Vertticom</option><option>LRocha</option>
    </select>
    <input class="input" id="qaTitle" placeholder="Nova tarefa..." style="min-width:220px">
    <select class="select" id="qaStatus">
      <option value="parado">Parado</option><option value="em_producao">Em produ√ß√£o</option><option value="atrasado">Atrasado</option><option value="feito">Feito</option>
    </select>
    <select class="select" id="qaDay"></select>
    <button class="btn" id="qaAdd">Adicionar</button>
  </div>

  <!-- Agenda -->
  <div class="card agenda" style="margin-top:12px">
    <div class="sectionTitle"><span class="icon">üóìÔ∏è</span> Agenda da semana</div>
    <div id="agenda"></div>
  </div>

  <!-- Estat√≠stica por cliente -->
  <div class="card" style="margin-top:14px">
    <div class="sectionTitle"><span class="icon">üìä</span> Por cliente</div>
    <div class="clientsBar" id="clientsBar"></div>
    <div class="muted">Clique no cliente para filtrar a lista acima.</div>
    <div style="overflow:auto; margin-top:8px">
      <table>
        <thead><tr><th>Cliente</th><th class="right">Conclu√≠das</th><th class="right">Total</th></tr></thead>
        <tbody id="tblClients"></tbody>
      </table>
    </div>
  </div>

  <p class="muted" style="margin-top:14px">Dica: clique no ‚Äústatus‚Äù ao lado de cada tarefa para alternar (Parado ‚Üí Em produ√ß√£o ‚Üí Atrasado ‚Üí Feito). Clique no texto para marcar/desmarcar conclu√≠da.</p>
</div>

<script>
(function(){
  // ------------ Utilidades de data ------------
  function pad(n){return (n<10?'0':'')+n;}
  function toISO(d){d.setHours(0,0,0,0);return d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate());}
  function fromISO(s){var p=s.split('-').map(function(x){return parseInt(x,10)});var d=new Date(p[0],p[1]-1,p[2]);d.setHours(0,0,0,0);return d;}
  function mondayOf(d){var day=d.getDay();var diff=(day===0?-6:1-day);var nd=new Date(d);nd.setDate(d.getDate()+diff);nd.setHours(0,0,0,0);return nd;}
  function addDaysISO(iso,days){var d=fromISO(iso);d.setDate(d.getDate()+days);return toISO(d);}
  function brDay(d){ var w=['dom','seg','ter','qua','qui','sex','s√°b']; return w[d.getDay()]+'. '+pad(d.getDate())+'/'+pad(d.getMonth()+1); }

  // ------------ Dados / Estado ------------
  var STATUS=['parado','em_producao','atrasado','feito'];
  var LABEL={parado:'Parado', em_producao:'Em produ√ß√£o', atrasado:'Atrasado', feito:'Feito'};
  var PILL={'Construcione':'c-construcione','Matec':'c-matec','Vertticom':'c-vertticom','LRocha':'c-lrocha'};

  var weekStart = toISO(mondayOf(new Date()));
  var tasks=[]; // {id, title, client, status, day, done}
  var activeClient = 'todos';

  // ------------ Storage ------------
  function key(){return 'dipe_pro_week_'+weekStart;}
  function canLS(){try{localStorage.setItem('__t','1');localStorage.removeItem('__t');return true;}catch(e){return false;}}
  function load(){
    if(canLS()){
      var raw=localStorage.getItem(key());
      if(raw){try{var data=JSON.parse(raw); if(data&&data.length) return data;}catch(e){}}
    }
    // seed
    var tue=addDaysISO(weekStart,1), wed=addDaysISO(weekStart,2), thu=addDaysISO(weekStart,3);
    var s=[
      {id:'a1',client:'Matec',title:'Post Caf√© Cultural Sto.Agostinho',status:'parado',day:tue,done:false},
      {id:'a2',client:'Construcione',title:'Post Setembro Amarelo',status:'parado',day:tue,done:false},
      {id:'a3',client:'Construcione',title:'Cartaz Setembro Amarelo',status:'parado',day:tue,done:false},
      {id:'b1',client:'Matec',title:'Post do Dia | Enquete',status:'parado',day:wed,done:false},
      {id:'b2',client:'Matec',title:'Terminar Mascote',status:'parado',day:wed,done:false},
      {id:'b3',client:'Vertticom',title:'Arrumar p√°gina de empreendimento',status:'parado',day:wed,done:false},
      {id:'b4',client:'Matec',title:'Post Voluntariado',status:'parado',day:wed,done:false},
      {id:'c1',client:'Construcione',title:'Post TBT Danone',status:'parado',day:thu,done:false},
      {id:'c2',client:'Construcione',title:'Arquitetura da Informa√ß√£o (Site)',status:'parado',day:thu,done:false},
      {id:'c3',client:'Construcione',title:'Reda√ß√£o',status:'parado',day:thu,done:false}
    ];
    if(canLS()){try{localStorage.setItem(key(), JSON.stringify(s));}catch(e){}}
    return s;
  }
  function save(){ if(canLS()){ try{ localStorage.setItem(key(), JSON.stringify(tasks)); }catch(e){} } }

  // ------------ Elementos ------------
  var weekRange=document.getElementById('weekRange');
  var weekPick=document.getElementById('weekPick');
  var agenda=document.getElementById('agenda');
  var q=document.getElementById('q');
  var hideDone=document.getElementById('hideDone');
  var statusSel=document.getElementById('statusSel');
  var csvBtn=document.getElementById('csvBtn');
  var clientsBar=document.getElementById('clientsBar');
  var tblClients=document.getElementById('tblClients');

  // Quick add
  var qaClient=document.getElementById('qaClient');
  var qaTitle=document.getElementById('qaTitle');
  var qaStatus=document.getElementById('qaStatus');
  var qaDay=document.getElementById('qaDay');

  // ------------ Navega√ß√£o semana ------------
  document.getElementById('prevW').addEventListener('click', function(){ gotoWeek(addDaysISO(weekStart,-7)); });
  document.getElementById('nextW').addEventListener('click', function(){ gotoWeek(addDaysISO(weekStart, 7)); });
  weekPick.addEventListener('change', function(e){ if(!e.target.value) return; gotoWeek(toISO(mondayOf(fromISO(e.target.value)))); });

  // ------------ Filtros / eventos ------------
  q.addEventListener('input', renderAll);
  hideDone.addEventListener('change', renderAll);
  statusSel.addEventListener('change', renderAll);
  csvBtn.addEventListener('click', exportCSV);

  document.getElementById('qaAdd').addEventListener('click', function(){
    var title=(qaTitle.value||'').trim();
    if(!title){ alert('Escreva um t√≠tulo.'); return; }
    tasks.push({id:String(Math.random()).slice(2,9), client:qaClient.value, title:title, status:qaStatus.value, day:qaDay.value, done:false});
    qaTitle.value=''; save(); renderAll();
  });

  // ------------ Render principal ------------
  function renderAll(){
    // range da semana
    var start=fromISO(weekStart); var end=fromISO(addDaysISO(weekStart,6));
    weekRange.textContent = 'Semana ' + pad(start.getDate()) + '/' + pad(start.getMonth()+1) + ' ‚Äì ' + pad(end.getDate()) + '/' + pad(end.getMonth()+1);
    weekPick.value = weekStart;

    // preencher select de dia do quick add
    qaDay.innerHTML='';
    var dlist=[]; var i;
    for(i=0;i<7;i++){ dlist.push(addDaysISO(weekStart,i)); }
    for(i=0;i<dlist.length;i++){ var d=fromISO(dlist[i]); var o=document.createElement('option'); o.value=dlist[i]; o.textContent=brDay(d); qaDay.appendChild(o); }
    if(!qaDay.value) qaDay.value=dlist[0];

    renderAgenda();
    renderClients();
  }

  function getFiltered(){
    var txt=(q.value||'').toLowerCase();
    var st=statusSel.value; // 'todas' ou status
    var out=[], i;
    for(i=0;i<tasks.length;i++){
      var t=tasks[i];
      if(activeClient!=='todos' && t.client!==activeClient) continue;
      if(st!=='todas' && t.status!==st) continue;
      if(hideDone.checked && t.done) continue;
      if(txt){
        var hay=(t.title+' '+t.client).toLowerCase();
        if(hay.indexOf(txt)===-1) continue;
      }
      out.push(t);
    }
    return out;
  }

  function renderAgenda(){
    agenda.innerHTML='';
    var byDay={}, i;
    var filtered=getFiltered();
    for(i=0;i<7;i++){ byDay[addDaysISO(weekStart,i)]=[]; }
    for(i=0;i<filtered.length;i++){ if(byDay[filtered[i].day]) byDay[filtered[i].day].push(filtered[i]); }

    for(var dayISO in byDay){
      var dayArr=byDay[dayISO];
      var d=fromISO(dayISO);
      var h=document.createElement('h3'); h.textContent=brDay(d); agenda.appendChild(h);
      var ul=document.createElement('ul');
      if(dayArr.length===0){ var li=document.createElement('li'); li.className='muted'; li.textContent='Sem tarefas.'; ul.appendChild(li); }
      for(i=0;i<dayArr.length;i++){
        var t=dayArr[i];
        var li=document.createElement('li');
        if(t.done) li.className='done';
        // [cliente] T√≠tulo  + chip de status
        var tag=document.createElement('span'); tag.className='tag '+(PILL[t.client]||''); tag.textContent=t.client; li.appendChild(tag);

        var txt=document.createElement('span'); txt.textContent=' '+t.title; txt.style.cursor='pointer';
        txt.onclick=(function(ref){ return function(){ ref.done=!ref.done; save(); renderAll(); }; })(t);
        li.appendChild(txt);

        var st=document.createElement('span'); st.className='st '+t.status;
        var dot=document.createElement('span'); dot.className='dot'; st.appendChild(dot);
        var lab=document.createElement('span'); lab.textContent=' '+(LABEL[t.status]||t.status); st.appendChild(lab);
        st.title='Clique para mudar o status';
        st.onclick=(function(ref){ return function(){ var idx=0,j; for(j=0;j<STATUS.length;j++){ if(STATUS[j]===ref.status){ idx=j; break; } } ref.status=STATUS[(idx+1)%STATUS.length]; save(); renderAll(); }; })(t);
        li.appendChild(st);

        ul.appendChild(li);
      }
      agenda.appendChild(ul);
    }
  }

  function renderClients(){
    // contagem por cliente
    var map={}, i;
    for(i=0;i<tasks.length;i++){
      var c=tasks[i].client;
      if(!map[c]) map[c]={done:0,total:0};
      map[c].total++; if(tasks[i].done) map[c].done++;
    }

    // chips de filtro
    clientsBar.innerHTML='';
    var all=document.createElement('button'); all.className='chip'+(activeClient==='todos'?' active':''); all.textContent='Todos';
    all.onclick=function(){ activeClient='todos'; renderAll(); };
    clientsBar.appendChild(all);

    for(var k in map){
      var b=document.createElement('button'); b.className='chip '+(PILL[k]||'')+(activeClient===k?' active':''); b.textContent=k;
      (function(name){ b.onclick=function(){ activeClient=(activeClient===name?'todos':name); renderAll(); }; })(k);
      clientsBar.appendChild(b);
    }

    // tabela
    tblClients.innerHTML='';
    for(var cName in map){
      var tr=document.createElement('tr');
      var td1=document.createElement('td'); var chip=document.createElement('span'); chip.className='chip '+(PILL[cName]||''); chip.textContent=cName; td1.appendChild(chip);
      var td2=document.createElement('td'); td2.className='right'; td2.textContent=map[cName].done;
      var td3=document.createElement('td'); td3.className='right'; td3.textContent=map[cName].total;
      tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
      tblClients.appendChild(tr);
    }
  }

  function exportCSV(){
    var rows = [['Dia','Data','Cliente','T√≠tulo','Status','Conclu√≠da']];
    var filtered=getFiltered();
    for(var i=0;i<filtered.length;i++){
      var t=filtered[i];
      var d=fromISO(t.day);
      rows.push([brDay(d), t.day, t.client, t.title.replace(/\\n/g,' '), LABEL[t.status]||t.status, t.done?'Sim':'N√£o']);
    }
    var csv = '';
    for(i=0;i<rows.length;i++){ csv += rows[i].map(function(s){ s=String(s); if(s.indexOf(',')>-1 || s.indexOf('"')>-1){ s='"'+s.replace(/"/g,'""')+'"'; } return s; }).join(',') + '\\n'; }
    var blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'tarefas-semana.csv';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  }

  function gotoWeek(startISO){
    weekStart = startISO;
    tasks = load();
    renderAll();
  }

  // init
  gotoWeek(toISO(mondayOf(new Date())));
})();
</script>
</body>
</html>
